# =============================================================================
# Import Linter Configuration
# =============================================================================
# Enforces architectural boundaries between modules to maintain clean layering.
# Run with: lint-imports
# =============================================================================

[importlinter]
root_package = mcp_coder
root_package_paths = src

# -----------------------------------------------------------------------------
# Contract: Layered Architecture
# -----------------------------------------------------------------------------
# Ensures dependencies flow downward through the architecture:
#   cli -> workflows -> llm/formatters -> utils -> config
#
# Why this matters:
# - Prevents circular dependencies between modules
# - Keeps the CLI as a thin presentation layer
# - Ensures workflows orchestrate but don't leak into infrastructure
# - Maintains utils as reusable, independent components
#
# Known violations to address (TODO: create issues for these):
# - mcp_coder.utils.commit_operations imports from llm and prompt_manager
#   -> This module should be moved to workflows layer
# -----------------------------------------------------------------------------
[importlinter:contract:layered_architecture]
name = Layered Architecture
type = layers
layers =
    mcp_coder.cli
    mcp_coder.workflows
    mcp_coder.workflow_utils
    mcp_coder.llm | mcp_coder.formatters | mcp_coder.prompt_manager
    mcp_coder.utils | mcp_coder.mcp_code_checker
    mcp_coder.config | mcp_coder.constants
ignore_imports =
    mcp_coder.utils.commit_operations -> mcp_coder.llm.env
    mcp_coder.utils.commit_operations -> mcp_coder.llm.interface
    mcp_coder.utils.commit_operations -> mcp_coder.llm.providers.claude.claude_code_api
    mcp_coder.utils.commit_operations -> mcp_coder.prompt_manager
    mcp_coder.utils.commit_operations -> mcp_coder.constants

# -----------------------------------------------------------------------------
# Contract: Domain Services Independence
# -----------------------------------------------------------------------------
# LLM and Formatters are parallel domain services that should not depend on
# each other. They serve different purposes and should remain decoupled.
#
# Why this matters:
# - Allows independent evolution of LLM and formatting capabilities
# - Prevents feature creep between unrelated domains
# - Makes it easier to replace or modify one without affecting the other
# -----------------------------------------------------------------------------
[importlinter:contract:domain_services]
name = Domain Services Independence
type = independence
modules =
    mcp_coder.llm
    mcp_coder.formatters

# -----------------------------------------------------------------------------
# Contract: Formatter Implementations Independence
# -----------------------------------------------------------------------------
# Black and isort formatters should not import from each other.
# They are independent formatting tools that can be used separately.
#
# Why this matters:
# - Each formatter can be replaced or updated independently
# - Avoids coupling between different formatting strategies
# - Keeps formatter implementations focused and simple
# -----------------------------------------------------------------------------
[importlinter:contract:formatter_implementations]
name = Formatter Implementations Independence
type = independence
modules =
    mcp_coder.formatters.black_formatter
    mcp_coder.formatters.isort_formatter

# -----------------------------------------------------------------------------
# Contract: External Service Integrations Independence
# -----------------------------------------------------------------------------
# GitHub and Jenkins integrations should not depend on each other.
# They are separate external services with independent APIs.
#
# Why this matters:
# - Allows using one service without the other
# - Keeps external service integrations focused
# - Easier to add new integrations without entangling existing ones
#
# Known violation to address (TODO: create issue):
# - mcp_coder.utils.github_operations.pr_manager imports from mcp_coder.utils
#   which transitively imports jenkins_operations via __init__.py
#   -> Solution: Refactor utils/__init__.py to not re-export all submodules
# -----------------------------------------------------------------------------
[importlinter:contract:external_services]
name = External Service Integrations Independence
type = independence
modules =
    mcp_coder.utils.github_operations
    mcp_coder.utils.jenkins_operations
ignore_imports =
    mcp_coder.utils.github_operations.pr_manager -> mcp_coder.utils

# -----------------------------------------------------------------------------
# Contract: Git Operations Local Independence
# -----------------------------------------------------------------------------
# Local git operations should not depend on remote service integrations.
# Git operations work with the local repository only.
#
# Why this matters:
# - Keeps git operations usable offline
# - Maintains clear separation between local and remote operations
# - Allows testing git operations without network mocking
# -----------------------------------------------------------------------------
[importlinter:contract:git_local]
name = Git Operations Local Independence
type = forbidden
source_modules =
    mcp_coder.utils.git_operations
forbidden_modules =
    mcp_coder.utils.github_operations
    mcp_coder.utils.jenkins_operations
