# CI Failure Analysis

The CI pipeline failed due to two separate issues affecting 7 unit tests in total.

The first issue affects 6 tests in `tests/workflows/create_pr/test_repository.py` (all tests in `TestCleanupRepository`). These tests attempt to mock `mcp_coder.workflows.create_pr.core.truncate_task_tracker`, but this function does not exist in the `core.py` module. Looking at the actual implementation in `src/mcp_coder/workflows/create_pr/core.py`, the `cleanup_repository` function calls `delete_pr_info_directory` and `clean_profiler_output`, but there is no `truncate_task_tracker` function imported or used. The tests were written expecting a `truncate_task_tracker` function that was either never implemented, was removed, or was renamed. The tests need to be updated to match the actual implementation, which uses `delete_pr_info_directory` to remove the entire `pr_info/` directory rather than truncating individual files.

The second issue affects 1 test in `tests/workflows/implement/test_prerequisites.py` (`TestIntegration::test_all_prerequisites_pass_with_mocks`). This test mocks the `Path.exists` method and calls `check_prerequisites(project_dir)` with a path `/test/project`. The test mocks `_read_task_tracker` to return `"content"`, but the actual `check_prerequisites` function in `src/mcp_coder/workflows/implement/prerequisites.py` calls `validate_task_tracker()` which in turn calls `_read_task_tracker()` to read the actual file. The mock for `_read_task_tracker` is correctly set up but the `validate_task_tracker` function is reading from the file path `/test/project/pr_info/TASK_TRACKER.md` which doesn't exist on disk. The test needs to also mock `validate_task_tracker` itself, or the test needs to create an actual temporary directory structure instead of using a fake path with mocks.

To fix these issues: (1) Update `test_repository.py` to mock the functions that `cleanup_repository` actually calls (`delete_pr_info_directory`, `clean_profiler_output`, `delete_conversations_directory`) instead of the non-existent `truncate_task_tracker`; (2) Update `test_all_prerequisites_pass_with_mocks` to either mock `validate_task_tracker` directly or use a real temporary directory with a valid TASK_TRACKER.md file.