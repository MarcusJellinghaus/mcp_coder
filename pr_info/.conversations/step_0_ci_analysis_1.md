# CI Failure Analysis

The CI pipeline failed with 20 test failures in `tests/cli/commands/coordinator/test_vscodeclaude.py`. The failures fall into three distinct categories:

**1. Template KeyError failures (6 tests):** The `WORKSPACE_FILE_TEMPLATE` and `TASKS_JSON_TEMPLATE` in `vscodeclaude_templates.py` use Python's `.format()` method, but the template strings contain JSON with curly braces (`{` and `}`). When `.format()` is called, Python interprets the JSON structural braces (like `"folders"` and `"version"`) as format placeholders, causing `KeyError` exceptions. The templates need their literal curly braces escaped as `{{` and `}}` to distinguish them from the actual format placeholders like `{folder_path}` and `{script_path}`. Affected tests: `test_workspace_file_is_valid_json_template`, `test_tasks_json_is_valid_json_template`, `test_create_workspace_file`, `test_create_workspace_file_truncates_long_title`, `test_create_vscode_task`.

**2. Mock function signature mismatches (12 tests):** Multiple tests are failing with `TypeError: mock function takes 1 positional argument but 2 were given`. The tests define mock functions for `get_config_values` and `load_labels_config` with only `self` as a parameter, but the actual functions being mocked expect additional arguments. `get_config_values(keys)` takes a list of config key tuples, and `load_labels_config(config_path)` takes a Path argument. The mock functions in the tests need to accept these parameters (e.g., `def mock_get_config_values(self, keys)` and `def mock_load_labels_config(self, config_path)`). Additionally, tests mocking `create_default_config` use lambdas taking 0 arguments but the actual function takes no arguments yet is called as a method, so the mock needs to accept `self`. Affected tests: all `TestConfiguration` tests, all `TestIssueSelection` tests, and two `TestCommandHandlers` tests.

**3. Startup script placeholder assertion failures (4 tests):** Tests like `test_startup_script_windows_has_placeholders` and `test_startup_script_linux_has_placeholders` assert that `{issue_number}` appears in the template, but the templates in `vscodeclaude_templates.py` use Python format string syntax with format specs like `#{issue_number:6}` (padded to 6 characters). The assertions need to account for the format specification or use different patterns to verify the placeholders exist. Similarly, `test_banner_template_has_placeholders` and `test_banner_template_formatting` have issues where the template uses `{stage_name:40}` with padding, and the formatting test expects `#123` but the template produces padded output like `# ...` due to the format specification.

The fixes require changes to: `src/mcp_coder/cli/commands/coordinator/vscodeclaude_templates.py` (escape JSON braces in templates) and `tests/cli/commands/coordinator/test_vscodeclaude.py` (fix mock function signatures and update placeholder assertions to match actual template syntax).