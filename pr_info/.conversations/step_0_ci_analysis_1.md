# CI Failure Analysis

The CI pipeline failed in the unit-tests job with 19 test failures across two test files. There are two distinct failure patterns with different root causes.

The first failure pattern affects 3 tests in `tests/workflows/vscodeclaude/test_orchestrator_sessions.py` (test_restart_closed_sessions_relaunches, test_restart_closed_sessions_skips_blocked_issues, test_restart_closed_sessions_updates_session_status). These tests fail with `AttributeError: 'module' object at mcp_coder.workflows.vscodeclaude.orchestrator has no attribute 'is_session_stale'`. The tests are mocking `mcp_coder.workflows.vscodeclaude.orchestrator.is_session_stale`, but according to Step 4 of the implementation plan, the `is_session_stale` check was removed from `orchestrator.py` as it became redundant after adding the eligibility check. The tests still attempt to mock this removed reference, which no longer exists in the module. The fix requires updating these three tests to remove the monkeypatch for `is_session_stale` since that function is no longer called or imported by `orchestrator.py`.

The second failure pattern affects 16 tests in `tests/workflows/vscodeclaude/test_status_display.py` (all tests in TestClosedIssuePrefixDisplay and TestBotStageSessionsDeleteAction and TestPrCreatedSessionsDeleteAction classes). These tests fail with `ValueError: GitHub token not found`. The error originates in `status.py:125` where `is_session_stale()` is called. When `is_session_stale()` is called without cached_issues and the issue is closed (mocked as True by tests), it falls through to create a new `IssueManager` instance which requires a GitHub token. The tests mock `is_issue_closed` to return True but don't provide cached_issues, and they also don't mock `is_session_stale`. When `is_session_stale` is called on a closed issue without cached_issues, it attempts to create an IssueManager which fails in CI where no GitHub token is configured. The fix requires adding a monkeypatch for `is_session_stale` in all affected tests (similar to the working tests in TestStatusDisplay class that already mock this function).

Files requiring changes: `tests/workflows/vscodeclaude/test_orchestrator_sessions.py` (remove 3 obsolete `is_session_stale` monkeypatches) and `tests/workflows/vscodeclaude/test_status_display.py` (add `is_session_stale` monkeypatch to 16 tests in TestClosedIssuePrefixDisplay, TestBotStageSessionsDeleteAction, and TestPrCreatedSessionsDeleteAction classes).