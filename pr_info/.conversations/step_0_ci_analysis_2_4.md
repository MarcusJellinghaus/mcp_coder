# CI Failure Analysis

The CI pipeline failed with 29 test failures across three main test files: `tests/workflow_utils/test_commit_operations.py`, `tests/utils/test_branch_status.py`, and `tests/cli/commands/test_check_branch_status.py`. The root cause is a mismatch between test mocking expectations and the actual implementation.

The primary issue affects commit operations tests. The tests in `TestGenerateCommitMessageWithLLM` are attempting to patch `mcp_coder.workflow_utils.commit_operations.get_prompt`, but the actual implementation imports `get_prompt` locally inside the function using `from ..prompt_manager import get_prompt`. Since the import happens inside the function rather than at module level, the patch target `mcp_coder.workflow_utils.commit_operations.get_prompt` doesn't exist as a module attribute, causing AttributeError failures. The tests need to either patch `mcp_coder.prompt_manager.get_prompt` directly, or the implementation needs to import `get_prompt` at the module level so it can be patched where it's used.

The branch status tests have multiple issues. First, `test_dataclass_immutability` expects the frozen dataclass to raise `FrozenInstanceError` when using `object.__setattr__()`, but frozen dataclasses don't raise this error for `object.__setattr__()` - they only prevent normal attribute assignment. Second, several `collect_branch_status` tests fail because they don't mock `get_current_branch_name`, which is called at the start of `collect_branch_status()` and returns `None`, causing the function to return an empty report with `NOT_CONFIGURED` status instead of the expected mocked values. Third, `test_generate_recommendations_logic` has an IndexError because the `_generate_recommendations` function returns `["Configure CI pipeline"]` for `NOT_CONFIGURED` status, but the test expects `["Ready to merge"]` at index 0.

The check_branch_status command tests fail because `_run_auto_fixes` receives `execution_dir` as a `Path` object from `resolve_execution_dir()` but the test expects `None`. Additionally, some tests patch `get_current_branch_name` at the wrong module path - they patch `mcp_coder.cli.commands.check_branch_status.get_current_branch_name` but the function imports it from `mcp_coder.utils.git_operations.readers`.

Files requiring changes: `tests/workflow_utils/test_commit_operations.py` (fix patch targets for `get_prompt`), `tests/utils/test_branch_status.py` (add missing mocks for `get_current_branch_name`, fix immutability test, fix recommendation test assertions), and `tests/cli/commands/test_check_branch_status.py` (fix execution_dir expectations and patch paths for `get_current_branch_name`).