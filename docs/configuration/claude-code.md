# Claude Code Configuration

Configuration guide for Claude Code CLI to work with MCP Coder workflows.

## Overview

Claude Code CLI is the primary LLM interface for MCP Coder's automated workflows. This guide covers:

- Claude Code CLI installation and verification
- Project configuration files (`.claude/` folder)
- Integration with mcp-coder commands

> **Note:** For MCP server configuration (`.mcp.json`), see [Repository Setup Guide](../repository-setup.md#mcp-json---mcp-server-configuration).

## Installation

### Prerequisites

- **Anthropic API Key**: Required for Claude API access
- **Python 3.11+**: For MCP server compatibility
- **Git**: For repository operations

### Claude Code CLI Installation

Follow the official installation guide at [Anthropic's documentation](https://docs.anthropic.com/en/docs/claude-code).

### Windows-Specific Setup

**Start Claude in PowerShell:**
```powershell
& "$env:USERPROFILE\.local\bin\claude.exe"
```

**Start Claude in CMD:**
```cmd
C:\Users\%USERNAME%\.local\bin\claude.exe
```

**Add Claude to system PATH (CMD):**
```cmd
setx PATH "%PATH%;%USERPROFILE%\.local\bin"
```
Restart terminal after setting PATH. Then `claude` works from any directory.

### Verification

```bash
# Verify installation
claude --version

# Test basic functionality
claude -p "Hello, Claude!"
```

### Useful CLI Parameters

| Parameter | Description |
|-----------|-------------|
| `--version` | Show version and exit |
| `--help` | Show help message and exit |
| `-p "prompt"` | Run with a prompt non-interactively |
| `--mcp-config FILE` | Specify MCP configuration file |

**MCP management commands:**
```bash
claude mcp list                      # List MCP servers
claude mcp add-from-claude-desktop   # Import MCP config from Claude Desktop
```

### Interactive Commands

Commands available inside a Claude Code session:

| Command | Description |
|---------|-------------|
| `/` | Show available commands |
| `/help` | Show help information |
| `/exit` | Exit the current conversation |
| `/clear` | Clear the current conversation |
| `/doctor` | Run diagnostic check (including MCP servers) |
| `/mcp` | Show MCP servers, configurations, and tool documentation |
| `/init` | Configure initial memory settings |

### Authentication

1. **Get API Key**: Visit [Anthropic Console](https://console.anthropic.com) to create an API key

2. **Configure Authentication**: Claude Code CLI will prompt for API key on first use

3. **Verify Authentication**:
   ```bash
   mcp-coder verify
   ```

## Project Configuration Files

Claude Code uses a `.claude/` folder in your project root for configuration.

### Directory Structure

```
your-project/
├── .claude/
│   ├── CLAUDE.md              # Project instructions (mandatory)
│   ├── settings.local.json    # Local settings (optional)
│   └── commands/              # Slash commands (optional)
│       ├── commit_push.md
│       ├── plan_review.md
│       └── ...
├── .claude_code/
│   └── memory.jsonl           # Conversation history and context (auto-generated)
├── .mcp.json                  # MCP server config (see repository-setup.md)
└── ...
```

**Note:** The `.claude_code/memory.jsonl` file stores conversation history and context. It is auto-generated by Claude Code. Use `/init` to configure initial memory settings.

### `.claude/CLAUDE.md` - Project Instructions

This file contains **mandatory instructions** that Claude follows when working on your project. Claude reads this file at the start of every session.

**Purpose:**
- Define code quality requirements
- Set project-specific conventions
- Specify mandatory tool usage (e.g., MCP tools)
- Configure workflow behaviors

**Example:**
```markdown
# Project Instructions

## Code Quality Requirements

After making ANY code changes, you MUST run all quality checks:
- Pylint for code quality
- Pytest for tests
- Mypy for type checking

## Mandatory Tool Usage

Use MCP tools for all file operations:
- `mcp__filesystem__read_file()` instead of `Read()`
- `mcp__filesystem__edit_file()` instead of `Edit()`
- `mcp__code-checker__run_pytest_check()` instead of `Bash("pytest")`

## Project Conventions

- Use type hints for all functions
- Follow PEP 8 style guide
- Write docstrings for public functions
```

**See mcp-coder's own [CLAUDE.md](https://github.com/MarcusJellinghaus/mcp_coder/blob/main/.claude/CLAUDE.md) for a comprehensive example.**

### `.claude/settings.local.json` - Local Settings

Local settings that override defaults for your environment. This file is typically gitignored.

**Example:**
```json
{
  "permissions": {
    "allow": [
      "Bash(git status:*)",
      "Bash(git diff:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(./tools/format_all.sh:*)",
      "mcp__code-checker__*",
      "mcp__filesystem__*"
    ]
  }
}
```

**Common settings:**
- `permissions.allow` - Pre-approved tool patterns (avoids confirmation prompts)
- `permissions.deny` - Explicitly denied tool patterns

**Gitignore:** Add to `.gitignore`:
```gitignore
.claude/settings.local.json
```

### `.claude/commands/` - Slash Commands

Slash commands provide structured workflows for common tasks. They appear as `/command_name` in Claude Code.

**Creating a command:**

Create a markdown file in `.claude/commands/`:

```markdown
---
allowed-tools: Bash(git status:*), Bash(git diff:*), Read, Glob, Grep
workflow-stage: utility
---

# My Custom Command

Instructions for what Claude should do when this command is invoked.

## Steps

1. First, do this...
2. Then, do that...
```

**Frontmatter options:**
- `allowed-tools` - Tools permitted for this command
- `workflow-stage` - Category for organization

**Available commands** (see [Claude Code Cheat Sheet](../processes-prompts/claude_cheat_sheet.md) for full list):

| Command | Purpose |
|---------|---------|
| `/issue_analyse` | Analyze GitHub issue requirements |
| `/plan_review` | Review implementation plan |
| `/plan_approve` | Approve plan for implementation |
| `/implementation_review` | Code review |
| `/commit_push` | Format, commit, and push changes |
| `/rebase` | Rebase branch onto main |
| `/discuss` | Step-by-step discussion |

## Integration with mcp-coder Commands

### Using `--mcp-config`

All major mcp-coder commands support the `--mcp-config` flag:

```bash
# Specify MCP configuration
mcp-coder prompt "Analyze code" --mcp-config .mcp.json
mcp-coder implement --mcp-config .mcp.linux.json
mcp-coder create-plan 123 --mcp-config .mcp.windows.json
mcp-coder create-pr --mcp-config .mcp.json
```

### Automatic Platform Detection

Create platform-specific config files and mcp-coder will select automatically:

```bash
# Create all platform configs
touch .mcp.json .mcp.linux.json .mcp.windows.json .mcp.macos.json

# mcp-coder auto-detects platform
mcp-coder implement  # Uses appropriate config
```

### Environment Variables

mcp-coder sets these environment variables for MCP servers:

| Variable | Description |
|----------|-------------|
| `MCP_CODER_PROJECT_DIR` | Absolute path to project directory |
| `MCP_CODER_VENV_DIR` | Path to Python virtual environment |

Use these in `.mcp.json`:
```json
{
  "mcpServers": {
    "code-checker": {
      "args": ["--project-dir", "${MCP_CODER_PROJECT_DIR}"]
    }
  }
}
```

## Troubleshooting

### Claude Code CLI Issues

#### Error: Claude not found

```
'claude' is not recognized as a command
```

**Solutions:**
1. Verify installation: Follow [official docs](https://docs.anthropic.com/en/docs/claude-code)
2. Check PATH: Ensure Claude Code is in your system PATH
3. Restart terminal after installation

#### Error: Authentication failed

```
Error: Invalid API key
```

**Solutions:**
1. Re-authenticate: `claude auth`
2. Verify API key at [Anthropic Console](https://console.anthropic.com)
3. Check for expired keys

### Project Configuration Issues

#### CLAUDE.md not being followed

**Symptoms:** Claude ignores project instructions

**Solutions:**
1. Verify file location: Must be `.claude/CLAUDE.md` (not `CLAUDE.md` in root)
2. Check file encoding: Use UTF-8
3. Check for syntax errors in markdown
4. Make instructions clear and unambiguous

#### Slash commands not appearing

**Symptoms:** `/command` doesn't work

**Solutions:**
1. Verify file location: `.claude/commands/command_name.md`
2. Check filename: Must end in `.md`
3. Verify frontmatter syntax (YAML between `---` markers)
4. Restart Claude Code session

### Testing Configuration

```bash
# Verify Claude Code CLI
claude --version
claude -p "What files are in .claude folder?"

# Verify mcp-coder integration
mcp-coder verify

# Test with MCP config
mcp-coder prompt "List project files" --mcp-config .mcp.json
```

## Security Considerations

### API Key Protection

- **Never commit** API keys or `.anthropic` folder
- Use **environment variables** in CI/CD
- **Rotate keys** regularly

### Configuration File Security

**Add to `.gitignore`:**
```gitignore
# Claude Code local settings
.claude/settings.local.json

# MCP configs with sensitive paths (optional)
.mcp.*.json
```

## Related Documentation

- **[Repository Setup](../repository-setup.md)** - Complete project setup including MCP configuration
- **[Claude Desktop Configuration](claude-desktop.md)** - Alternative Claude interface
- **[Configuration Guide](config.md)** - General mcp-coder configuration
- **[Claude Code Cheat Sheet](../processes-prompts/claude_cheat_sheet.md)** - Slash command reference
- **[Development Process](../processes-prompts/development-process.md)** - Workflow methodology

## External Resources

- **[Claude Code Documentation](https://docs.anthropic.com/en/docs/claude-code)** - Official Anthropic documentation
- **[MCP Protocol](https://spec.modelcontextprotocol.io/)** - Model Context Protocol specification
